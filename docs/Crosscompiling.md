# Crosscompiling (Android and iOS)

## The AUI_BUILD_FOR way

AUI provides the unified way to cross-compile your application with AUI_BUILD_FOR CMake configure variable. When
specified, CMake does the whole configure routine as if the project is compiled for the host system but it generates
extra project directory for the target platform's development environment once the `apps` target is invoked.

To build target platform's final application package, run build the `apps` target.

## The CMAKE_TOOLCHAIN_FILE way

That's the common way of crosscompiling with CMake. You need a toolchain file which describes your target platform.

In Android, a Gradle-driven project provides the toolchain for you. You don't even need to specify CMAKE_TOOLCHAIN_FILE, 
 Gradle does it for you.

In iOS, there's no "official" toolchain so there are community-provided toolchains
(like the [one used in AUI](https://raw.githubusercontent.com/aui-framework/aui/master/cmake/toolchains/arm64-ios.cmake)).

AUI.Boot forwards `CMAKE_TOOLCHAIN_FILE` across all the dependencies.

### Usage Example
Assuming working directory is the build directory:

To configure the project use
```
cmake -DAUI_BUILD_FOR=android ..
```

To build the project use
```
cmake --build . -t apps
```


### Supported platforms

| `AUI_BUILD_FOR` value | Host platform       | Target platform | Project environment                        | Project dir                         |
|-----------------------|---------------------|-----------------|--------------------------------------------|-------------------------------------|
| `android`             | Windows Linux macOS | Android         | Gradle (can be opened with Android Studio) | `${CMAKE_BINARY_DIR}/app_project`   |
| `ios`                 | macOS               | iOS             | Xcode                                      | `${CMAKE_BINARY_DIR}/app_project`   |


### Limitations

1. Variables defined in the configure step (including the ones specified with command line by `-DVAR=VALUE` syntax) are
   not forwarded to the child CMake configure process. To bypass the limitation, use `auib_mark_var_forwardable(VAR)` 
   function, where `VAR` is your variable name.
2. As like CMake's generated projects, the projects generated by AUI are not portable too.

# Replacing AUI mobile project

Some projects may require their custom mobile project (Android Studio or Xcode), for example to specific mobile
features (such as Google Play Games integration, Face ID, etc). In this case, you would have to create your own project
and link AUI as a library.

## Android

1. Create new Android Studio project with native C++ support.
2. In your `app/src/cpp/CMakeLists.txt`, `add_subdirectory` your C++ application or directly `auib_import` the AUI
   framework (unrecommended because you will experience difficulties when compiling for other platforms).
3. Copy & paste AUI's [native Java code](https://github.com/aui-framework/aui/tree/master/platform/android) for Android
   to your project. You may also want to adjust your `app.gradle` and `AndroidManifest.xml`.
4. To draw AUI, you should use `GLSurfaceView` and [pass rendering routines](https://github.com/aui-framework/aui/blob/master/platform/android/lib/src/java/com/github/aui/android/AuiView.kt)
   to AUI. Also, take care of handling user input. Also, you can inflate [AuiView](https://github.com/aui-framework/aui/blob/master/platform/android/lib/src/java/com/github/aui/android/AuiView.kt)
   to your own Android layout.

## iOS
1. Create new Xcode project.
2. Since Xcode does not support CMake, you will have to compile AUI (and your C++ AUI application) by yourself (by
   creating Xcode rules or manually dropping compiled binaries to Xcode project).
3. [Take a look](https://github.com/aui-framework/aui/blob/master/aui.views/src/AUI/Platform/ios/AUIViewController.mm) on how does AUI handles its routines on iOS and implement them by yourself in your project.